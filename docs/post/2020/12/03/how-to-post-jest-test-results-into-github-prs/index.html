<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link
    rel="shortcut icon"
    type="image/x-icon"
    href="/assets/favicon.ico"
  />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Post Jest results into Github PRs | Oscar Franco</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Post Jest results into Github PRs" />
<meta name="author" content="Oscar Franco" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions" />
<meta property="og:description" content="At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions" />
<link rel="canonical" href="https://ospfranco.com/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/" />
<meta property="og:url" content="https://ospfranco.com/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/" />
<meta property="og:site_name" content="Oscar Franco" />
<meta property="og:image" content="https://ospfranco.com/assets/taco.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-03T14:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://ospfranco.com/assets/taco.png" />
<meta property="twitter:title" content="Post Jest results into Github PRs" />
<meta name="twitter:site" content="@ospfranco" />
<meta name="twitter:creator" content="@Oscar Franco" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Post Jest results into Github PRs","description":"At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions","author":{"@type":"Person","name":"Oscar Franco"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ospfranco.com/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/"},"datePublished":"2020-12-03T14:00:00+01:00","image":"https://ospfranco.com/assets/taco.png","url":"https://ospfranco.com/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/","dateModified":"2020-12-03T14:00:00+01:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/css/site.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap"
    rel="stylesheet"
  />
</head>

<html class="max-h-full bg-white dark:bg-black">
  <body class="max-h-full flex flex-col items-center">
    <div class="flex-1 flex flex-col items-center w-full lg:mx-36">
  <div
    class="
      text-coolGray-800
      dark:text-white
      text-xl
      self-center
      tracking-widest
      pb-4
      pt-20
    "
  >
    OSCAR FRANCO
  </div>
  <img
    src="/assets/profile.webp"
    class="rounded-full h-24 w-24 object-cover"
  />

  <div class="flex self-center p-4 dark:hidden">
    <a
      class="p-2 self-center"
      href="https://github.com/ospfranco?tab=followers"
    >
      <img
        src="https://img.shields.io/github/followers/ospfranco?label= &style=flat-square&logo=github&color=fff&logoColor=000"
      />
    </a>
    <a class="p-2 self-center" href="https://twitter.com/ospfranco">
      <img
        src="https://img.shields.io/twitter/follow/ospfranco?label= &style=flat-square&logo=twitter&color=fff"
      />
    </a>
    <a
      class="p-2 self-center"
      href="https://www.youtube.com/channel/UCHxMuqeVlkDgKG5cs99FH2Q"
    >
      <img
        src="https://img.shields.io/youtube/channel/subscribers/UCHxMuqeVlkDgKG5cs99FH2Q?label= &style=flat-square&logo=youtube&color=fff&logoColor=FF0000"
      />
    </a>
  </div>

  <div class="invisible self-center p-4 dark:visible flex">
    <a
      class="p-2 self-center"
      href="https://github.com/ospfranco?tab=followers"
    >
      <img
        src="https://img.shields.io/github/followers/ospfranco?label= &style=flat-square&logo=github&color=000"
      />
    </a>
    <a class="p-2 self-center" href="https://twitter.com/ospfranco">
      <img
        src="https://img.shields.io/twitter/follow/ospfranco?label= &style=flat-square&logo=twitter&color=000"
      />
    </a>
    <a
      class="p-2 self-center"
      href="https://www.youtube.com/channel/UCHxMuqeVlkDgKG5cs99FH2Q"
    >
      <img
        src="https://img.shields.io/youtube/channel/subscribers/UCHxMuqeVlkDgKG5cs99FH2Q?label= &style=flat-square&logo=youtube&color=000"
      />
    </a>
  </div>

  <div class="w-full md:w-768 text-center my-10 flex flex-col items-center">
    <h1 class="font-semibold text-3xl md:text-5xl dark:text-white">
      Post Jest results into Github PRs
    </h1>
    <div class="text-gray-500 dark:text-coolGray-300">
      December 2020
    </div>
  </div>

  <div class="markdown w-full px-6 md:px-0 md:w-768"><p>At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions</p>

<h2 id="why-leave-bitrise">Why leave Bitrise</h2>

<p>Bitrise is good because the amount of available workflows and steps and how you can chain them to create your CI workflow, however, it is <strong>really slow</strong> and it also <strong>expensive</strong> for faster build machines.</p>

<p>Even though we are already on a medium plan, we started having queueing slow downs, our app takes an hour to compile on iOS (plus Android and Huawei versions) and without paying more money everything slowed down, a simple PR would not get the tests to run for a solid hour blocking the entire team.</p>

<h2 id="github-actions-are-quite-good-actually">Github Actions are quite good actually</h2>

<p>They are fast, already run on the same platform where the code is, setting them up was a breeze and they are plenty fast</p>

<p>Getting things to run was a breeze, not a fan of yaml, but setting up the first iteration took 5 mins, here is a sample yaml:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">JS Checks</span>
<span class="na">on</span><span class="pi">:</span> <span class="s">push</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">tests</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Use Node.js 12.x</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2.1.2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="s">12.x</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">yarn</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">yarn test</span>
</code></pre></div></div>

<p>However, I wanted to push things a bit further, I hated having to open the bitrise log page, because loading web pages nowadays is sooo slow, so I wanted to see my failing tests directly on my PR!</p>

<p>A quick google search revealed nothing of use</p>

<h2 id="introducing-gh-jester">Introducing gh-jester</h2>

<p>I forked an old project that claimed to do what I needed, removed the unnecessary parts and added actually the useful output that I was looking for, you can check the <a href="https://github.com/ospfranco/gh-jester">source code</a>, here is a finished YAML you can copy and paste into your github repo:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">JS Checks</span>
<span class="na">on</span><span class="pi">:</span> <span class="s">push</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">tests</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cancel Previous Runs</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">styfle/cancel-workflow-action@0.6.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">access_token</span><span class="pi">:</span> <span class="s">$</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Use Node.js 12.x</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2.1.2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="s">12.x</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">yarn</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">ospfranco/gh-jester@v1.0.13</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">post-comment</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="na">GITHUB_CONTEXT</span><span class="pi">:</span> <span class="s">${{ toJson(github) }}</span>
</code></pre></div></div>

<p>Basically, it will run your jest tests and if the tests are failing it will post a nice resume on the commit itself (which will also appear on the PR), bear in mind, the trigger needs to be [push] for it to correctly post the comment with the info.</p>

<p><img src="https://ospfranco.com/assets/gh-jester.png" alt="gh-jester comment" title="gh-jester" /></p>

<p>And that is it! Now all the info for your PR is right on the comment section, enjoy!</p>
</div>

  <link
    rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/darcula.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>

  <script>
    hljs.initHighlightingOnLoad();
  </script>

  <a href="/">
    <button
      class="rounded-xl bg-blue-500 text-white mt-12 mb-44 py-3 px-6 font-bold"
    >
      HOMEPAGE
    </button>
  </a>
</div>

  </body>
</html>
