<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico"/>
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146785440-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-146785440-1');
</script>

  <link type="application/atom+xml" rel="alternate" href="https://ospfranco.github.io/feed.xml" title="Oscar Franco on Github" /> 
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Post Jest results into Github PRs | Oscar Franco on Github</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Post Jest results into Github PRs" />
<meta name="author" content="Oscar Franco" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions" />
<meta property="og:description" content="At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions" />
<link rel="canonical" href="https://ospfranco.github.io/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/" />
<meta property="og:url" content="https://ospfranco.github.io/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/" />
<meta property="og:site_name" content="Oscar Franco on Github" />
<meta property="og:image" content="https://ospfranco.github.io/assets/taco.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-03T14:00:00+01:00" />
<meta name="twitter:card" content="Blog about software engineering and life" />
<meta property="twitter:image" content="https://ospfranco.github.io/assets/taco.png" />
<meta property="twitter:title" content="Post Jest results into Github PRs" />
<meta name="twitter:site" content="@ospfranco" />
<meta name="twitter:creator" content="@Oscar Franco" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://ospfranco.github.io/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/"},"url":"https://ospfranco.github.io/post/2020/12/03/how-to-post-jest-test-results-into-github-prs/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://ospfranco.github.io/assets/taco.png"},"name":"Oscar Franco"},"author":{"@type":"Person","name":"Oscar Franco"},"image":"https://ospfranco.github.io/assets/taco.png","headline":"Post Jest results into Github PRs","description":"At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions","dateModified":"2020-12-03T14:00:00+01:00","datePublished":"2020-12-03T14:00:00+01:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/css/site.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/dracula.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>

  <script>hljs.initHighlightingOnLoad();</script>
</head>
<html class="max-h-full">
  <body class="max-h-full">
    <div class="h-full xl:flex justify-center">
      <div class="p-4 w-full xl:w-64 xl:h-full overflow-y-auto bg-gray-100">
        <div>
  <a
  class="flex flex-col items-center"
  href="/"
  >
    <img src="/assets/profile.webp" class="rounded-full h-32" />
    <h2 class="font-medium text-2xl mt-4">Oscar Franco</h2>
  </a>

  <div class="flex justify-center my-2">
    <a
      class="pr-4"
      href="https://twitter.com/ospfranco"
    >
      <img src="/assets/twitter.png" class="h-8">
    </a>
    <a
      href="https://github.com/ospfranco"
    >
      <img src="/assets/github.png" class="h-8">
    </a>
  </div>

  <p class="text-gray-800 mt-12 mb-8">Bolivian System's Engineer, trying to bootstrap products. Check these out!</p>
  
  
  <div>
    <a href="https://apps.apple.com/de/app/ci-demon/id1560355863?l=en&mt=12">
      <div class="flex w-full items-center">
        <div class="overflow-hidden py-3">
          <div class="text-blue-500 text-sm">CI Demon</div>
          <div class="font-extralight text-gray-700 text-sm">
            CI/CD on your Dekstop.
          </div>
          <a href="https://www.producthunt.com/posts/ci-demon?utm_source=badge-featured&utm_medium=badge&utm_souce=badge-ci-demon" target="_blank"><img src="https://api.producthunt.com/widgets/embed-image/v1/featured.svg?post_id=290593&theme=light" alt="CI Demon - Continuous integration builds in your desktop. | Product Hunt" style="width: 120px; height: 40px;" width="120" height="40" /></a>
        </div>
      </div>
    </a>

    <a href="https://apps.apple.com/de/app/tp-latino/id1483823093">
      <div class="flex w-full items-center">
        <div class=" overflow-hidden py-3">
            <div class="text-blue-500 text-sm">Test Prep Latino</div>
            <div class="font-extralight text-gray-700 text-sm">
              Practice for South-American flight pilot exams.
            </div>  
        </div>
      </div>
    </a>

    <a href="https://github.com/ospfranco/react-native-quick-sqlite">
      <div class="flex w-full items-center">
        <div class="overflow-hidden py-3">
          <div class="text-blue-500 text-sm">react-native-sqlite</div>
          <div class="font-extralight text-gray-700 text-sm">
            SQLite for react-native (with JSI bindings), the fastest sqlite library for react-native.
          </div>
        </div>
      </div>
    </a>

  </div>
</div>

      </div>
      <div class="w-full xl:overflow-y-scroll xl:w-2/3">
        <div class="flex-1">
  <div class="p-4">
    <h1 class="font-semibold text-2xl">Post Jest results into Github PRs</h1>
    <div class="text-gray-500 text-sm">
      December 2020
    </div>
    
    <div class="markdown mt-6">
      <p>At BodyFast we recently decided to migrate out of Bitrise for our javascript tests, that means, we continue to use Bitrise for building our react-native app but all other tests (jest, lint, flow, tsc) are now running on github actions</p>

<h2 id="why-leave-bitrise">Why leave Bitrise</h2>

<p>Bitrise is good because the amount of available workflows and steps and how you can chain them to create your CI workflow, however, it is <strong>really slow</strong> and it also <strong>expensive</strong> for faster build machines.</p>

<p>Even though we are already on a medium plan, we started having queueing slow downs, our app takes an hour to compile on iOS (plus Android and Huawei versions) and without paying more money everything slowed down, a simple PR would not get the tests to run for a solid hour  blocking the entire team.</p>

<h2 id="github-actions-are-quite-good-actually">Github Actions are quite good actually</h2>

<p>They are fast, already run on the same platform where the code is, setting them up was a breeze and they are plenty fast</p>

<p>Getting things to run was a breeze, not a fan of yaml, but setting up the first iteration took 5 mins, here is a sample yaml:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">JS Checks</span>
<span class="na">on</span><span class="pi">:</span> <span class="s">push</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">tests</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Use Node.js 12.x</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2.1.2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="s">12.x</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">yarn</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">yarn test</span>
</code></pre></div></div>

<p>However, I wanted to push things a bit further, I hated having to open the bitrise log page, because loading web pages nowadays is sooo slow, so I wanted to see my failing tests directly on my PR!</p>

<p>A quick google search revealed nothing of use</p>

<h2 id="introducing-gh-jester">Introducing gh-jester</h2>

<p>I forked an old project that claimed to do what I needed, removed the unnecessary parts and added actually the useful output that I was looking for, you can check the <a href="https://github.com/ospfranco/gh-jester">source code</a>, here is a finished YAML you can copy and paste into your github repo:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">JS Checks</span>
<span class="na">on</span><span class="pi">:</span> <span class="s">push</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">tests</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Cancel Previous Runs</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">styfle/cancel-workflow-action@0.6.0</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">access_token</span><span class="pi">:</span> <span class="s">$</span>
      <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Use Node.js 12.x</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v2.1.2</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">node-version</span><span class="pi">:</span> <span class="s">12.x</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install Dependencies</span>
        <span class="na">run</span><span class="pi">:</span> <span class="s">yarn</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run tests</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">ospfranco/gh-jester@v1.0.13</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">post-comment</span><span class="pi">:</span> <span class="no">true</span>
        <span class="na">env</span><span class="pi">:</span>
          <span class="na">GITHUB_TOKEN</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="na">GITHUB_CONTEXT</span><span class="pi">:</span> <span class="s">${{ toJson(github) }}</span>
</code></pre></div></div>

<p>Basically, it will run your jest tests and if the tests are failing it will post a nice resume on the commit itself (which will also appear on the PR), bear in mind, the trigger needs to be [push] for it to correctly post the comment with the info.</p>

<p><img src="https://ospfranco.github.io/assets/gh-jester.png" alt="gh-jester comment" title="gh-jester" /></p>

<p>And that is it! Now all the info for your PR is right on the comment section, enjoy!</p>

    </div>
  </div>

</div>
      </div>
    </div>

  </body>
</html>
