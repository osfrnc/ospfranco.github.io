<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link
    rel="shortcut icon"
    type="image/x-icon"
    href="/assets/favicon.ico"
  />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Stop throwing exceptions | Oscar Franco</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Stop throwing exceptions" />
<meta name="author" content="Oscar Franco" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Throwing exceptions completely breaks the control flow of programs and turns them unpredictable. Let’s explore their side-effects." />
<meta property="og:description" content="Throwing exceptions completely breaks the control flow of programs and turns them unpredictable. Let’s explore their side-effects." />
<link rel="canonical" href="https://ospfranco.com/post/2021/08/31/stop-throwing-exceptions/" />
<meta property="og:url" content="https://ospfranco.com/post/2021/08/31/stop-throwing-exceptions/" />
<meta property="og:site_name" content="Oscar Franco" />
<meta property="og:image" content="https://ospfranco.com/assets/preview.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-08-31T09:00:00-04:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://ospfranco.com/assets/preview.jpg" />
<meta property="twitter:title" content="Stop throwing exceptions" />
<meta name="twitter:site" content="@ospfranco" />
<meta name="twitter:creator" content="@Oscar Franco" />
<script type="application/ld+json">
{"@type":"BlogPosting","description":"Throwing exceptions completely breaks the control flow of programs and turns them unpredictable. Let’s explore their side-effects.","mainEntityOfPage":{"@type":"WebPage","@id":"https://ospfranco.com/post/2021/08/31/stop-throwing-exceptions/"},"image":"https://ospfranco.com/assets/preview.jpg","headline":"Stop throwing exceptions","dateModified":"2021-08-31T09:00:00-04:00","datePublished":"2021-08-31T09:00:00-04:00","url":"https://ospfranco.com/post/2021/08/31/stop-throwing-exceptions/","author":{"@type":"Person","name":"Oscar Franco"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/css/site.css" />
  <link rel="stylesheet" href="/css/inter.css" />
</head>

<html class="w-full">
  <body class="w-full flex flex-col items-center">
    <div class="flex-1 flex flex-col items-center w-full lg:mx-36 pt-20">
  <div class="flex items-center">
  <img
    src="/assets/profile.webp"
    class="h-24 w-24 md:h-32 md:w-32 rounded-full object-cover self-center"
  />
  <div class="px-8">
    <div class="text-2xl font-medium uppercase">Oscar</div>
    <div class="text-2xl font-medium uppercase">Franco</div>
    <div class="flex dark:hidden">
      <a
        class="pr-2 self-center"
        href="https://github.com/ospfranco?tab=followers"
      >
        <img
          src="https://img.shields.io/github/followers/ospfranco?label= &style=flat-square&logo=github&color=fff&logoColor=000"
        />
      </a>
      <a class="pr-2" href="https://twitter.com/ospfranco">
        <img
          src="https://img.shields.io/twitter/follow/ospfranco?label= &style=flat-square&logo=twitter&color=fff"
        />
      </a>
      <a
        class=""
        href="https://www.youtube.com/channel/UCHxMuqeVlkDgKG5cs99FH2Q"
      >
        <img
          src="https://img.shields.io/youtube/channel/subscribers/UCHxMuqeVlkDgKG5cs99FH2Q?label= &style=flat-square&logo=youtube&color=fff&logoColor=FF0000"
        />
      </a>
    </div>

    <div class="invisible dark:visible flex">
      <a
        class="pr-2 self-center"
        href="https://github.com/ospfranco?tab=followers"
      >
        <img
          src="https://img.shields.io/github/followers/ospfranco?label= &style=flat-square&logo=github&color=000"
        />
      </a>
      <a class="px-2 self-center" href="https://twitter.com/ospfranco">
        <img
          src="https://img.shields.io/twitter/follow/ospfranco?label= &style=flat-square&logo=twitter&color=000"
        />
      </a>
      <a
        class="px-2 self-center"
        href="https://www.youtube.com/channel/UCHxMuqeVlkDgKG5cs99FH2Q"
      >
        <img
          src="https://img.shields.io/youtube/channel/subscribers/UCHxMuqeVlkDgKG5cs99FH2Q?label= &style=flat-square&logo=youtube&color=000&logoColor=FF0000"
        />
      </a>
    </div>
  </div>
</div>


  <div class="w-full md:w-768 text-center my-10 flex flex-col items-center">
    <h1 class="font-semibold text-3xl md:text-4xl dark:text-white">
      Stop throwing exceptions
    </h1>
    <div class="text-gray-500 dark:text-coolGray-300">
      August 2021
    </div>
  </div>

  <div class="markdown w-full px-6 md:px-0 md:w-700"><p>Throwing exceptions completely breaks the control flow of programs and turns them unpredictable. Let’s explore their side-effects.</p>

<p>I’m going to use TypeScript/JavaScript, so some of these points will apply to JavaScript alone.</p>

<h1 id="exceptions-can-leak-memory">Exceptions can leak memory</h1>

<p><img src="https://ospfranco.com/assets/errorStack.png" alt="errorStack" title="errorStack" /></p>

<blockquote>
  <p>The error keeps the function frames around until it the stack string is created or it is garbage collected</p>
</blockquote>

<p>It’s a bit of an edge case, but given a large enough application this make your app run out of memory.</p>

<h1 id="exceptions-stab-you-in-the-back">Exceptions stab you in the back</h1>

<p>Let start with simple axiom: <strong>unexpected things happen all the time</strong>. Some unexpected things are fairly common: users input weird characters, things get deleted, libraries have nested behaviors we are not aware of, etc. Yet some other unexpected things are more serious and cannot be recovered from: disks get full, some dll is missing, program is missconfigured, etc. The way the ecosystem today works is by throwing exceptions whenever unexpected things happen.</p>

<p>The problem comes when we forget to handle these exceptions. For example: user inputs weird character that fails to parse as an int in some dependency of the dependency, <strong>OOPS!</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// oops forgot to sanitize my input</span>
<span class="kd">let</span> <span class="nx">userInput</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10a</span><span class="dl">"</span><span class="p">;</span>

<span class="c1">// APPLICATION CRASH! 10a cannot be parsed as a int!</span>
<span class="kd">let</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">originalDate</span><span class="p">.</span><span class="nx">setDay</span><span class="p">(</span><span class="nx">userInput</span><span class="p">).</span><span class="nx">toISO</span><span class="p">();</span>

<span class="c1">// it might not even be thrown by the date library, but some second level dependency...</span>
</code></pre></div></div>

<p>The problem with this kind of exceptions is that a lot of times they are completely implicit and invisible to the final user of the code. The path the exception has taken back is also completely implicit, did the error generate in some deeply nested function? It has bulldozed its way to your code and if unhandled will promptly crash your application.</p>

<p><strong>How do I know which function can throw? do I have to try…catch every single line of code I have not written myself?</strong></p>

<h1 id="some-exceptions-are-real-exceptions">Some exceptions are real exceptions</h1>

<p>So if exceptions are so disruptive to the flow of a program, why do we use them?</p>

<p>So let’s go back in history a bit, in the earlier days of computing, programs were not as brittle as they are nowadays, that is because exceptions were reserved for kernel panic calls. If your program succesfully executed its task it would end with a 0 integer and anything else meant a unsuccessful execution. Besides C, this is still visible in shell scripts, where if a command fails with a non-zero exit code, it means it has not succesfully completed.</p>

<p>Why did we start using exceptions? Well, seems like somebody looked at them and went something like “that’s a neat trick! I can just throw an exception here and catch it somewhere above my stack! It even unwinds the call stack for me!”. Other than that there is no good reason to use them in our user code.</p>

<p>But if we adopt the philosphy of “exceptions are meant for true panic calls” we can adopt a far better coding styling, one that would bring back the stability of the software of the 70s.</p>

<h1 id="error-carrying-monads">Error carrying monads</h1>

<p>Forget the fancy title for a bit, we can basically skip all the ceremony and adopt the following coding style:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">userInput</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10a</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">let</span> <span class="p">{</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">date</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">originalDate</span><span class="p">.</span><span class="nx">setDay</span><span class="p">(</span><span class="nx">userInput</span><span class="p">).</span><span class="nx">toISO</span><span class="p">();</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handle the error gracefully</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// do my thing</span>
</code></pre></div></div>

<p>This brings multiple benefits:</p>

<ul>
  <li>Code that can fail becomes explicit (even better with TypeScript)</li>
  <li>Errors are part of the normal flow of a program</li>
  <li>Easily readable and the intention of the code is clear</li>
</ul>

<p>Many of the new languages, like Rust or Swift, have now used composite types that carry this information, which will even force you to handle code that can fail.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">enum</span> <span class="n">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">E</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="nf">Ok</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
    <span class="nf">Err</span><span class="p">(</span><span class="n">E</span><span class="p">),</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Using this on the JavaScript world would maybe look something like this:</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">userInput</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10a</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">dateResult</span> <span class="o">=</span> <span class="nx">originalDate</span><span class="p">.</span><span class="nx">setDay</span><span class="p">(</span><span class="nx">userInput</span><span class="p">).</span><span class="nx">toISO</span><span class="p">();</span>

<span class="k">switch</span> <span class="p">(</span><span class="nx">dateResult</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="nx">Ok</span><span class="p">:</span>
    <span class="c1">// do my thing dateResult.value</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="nx">Err</span><span class="p">:</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Could not parse date!</span><span class="dl">"</span><span class="p">,</span> <span class="nx">dateResult</span><span class="p">.</span><span class="nx">err</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>That my friend, is an <code class="language-plaintext highlighter-rouge">Error Monad</code>. Now you know a bit of functional programming too! This struct is not available in JavaScript yet, but you can return tuples or objects and the result is just as good!</p>

<h1 id="use-exceptions-for-real-panics">Use exceptions for real panics</h1>

<p>So now you can let real “exceptions” be what they were meant from… exceptional stuff. Things a program cannot recover from (full disk, wrong params, corrupted data, etc.), and therefore should crash the application. Whereas the rest of your code can communicate intent better, be more readable, explicit and easier to debug.</p>

<p>As a matter of fact there are several libraries that already follow this pattern: joi is one of them, as well as some API libraries like Stripe I believe.</p>

<h1 id="references">References</h1>

<p>Although I tweeted about this issue before, it was only after reading <a href="https://humanlytyped.hashnode.dev/away-from-exceptions-errors-as-values">Barise’s article</a> that I decided to write my own. And there are many more articles on the topic: <a href="https://mattwarren.org/2016/12/20/Why-Exceptions-should-be-Exceptional/">some against exceptions</a> some <a href="https://blog.plan99.net/what-s-wrong-with-exceptions-nothing-cee2ed0616">for them</a>.</p>

<p>I believe some of the claims <strong>for</strong> exceptions are quite missguided, such as: fast prototyping! Stack traces! etc. Exceptions are definitely useful and as stated some of this mechanisms are golden for real exceptional situations, but hurt so much when used freely and carelessly.</p>
</div>

  <link
    rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/darcula.min.css"
  />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>

  <script>
    hljs.initHighlightingOnLoad();
  </script>

  <a href="/">
    <button class="rounded-xl bg-blue-500 text-white mt-12 py-3 px-6 font-bold">
      See more
    </button>
  </a>
</div>

  </body>
  <footer
  class="
    w-full
    border-t
    dark:border-trueGray-600
    py-3
    mt-20
    flex
    justify-center
    items-center
  "
>
  <div class="md:w-768 px-6 md:px-0 flex flex-col items-center">
    <div class="font-medium py-1">Oscar Franco</div>
    <div class="flex">
      <a class="py-1" href="mailto:ospfranco@protonmail.com">Email</a>
      <a class="py-1 pl-4" href="https://github.com/ospfranco">Github</a>
      <a class="py-1 pl-4" href="https://twitter.com/ospfranco">Twitter</a>
      <a class="py-1 pl-4" href="https://youtube.com/ospfranco">Youtube</a>
      <a
        class="py-1 pl-4"
        href="https://www.linkedin.com/in/⚡%EF%B8%8F-oscar-franco-bbbb7319b/"
        >LinkedIn</a
      >
    </div>
  </div>
</footer>

</html>
