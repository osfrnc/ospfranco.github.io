<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta charset="utf-8" />
  <link
    rel="shortcut icon"
    type="image/x-icon"
    href="/assets/favicon.ico"
  />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Mix C++, Obj-C and Swift files in a single XCode targe | Oscar Franco</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Mix C++, Obj-C and Swift files in a single XCode targe" />
<meta name="author" content="Oscar Franco" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="If you have an XCode project where you are trying to mix C++, Obj-C and Swift, things will not work. If you only deal with Obj-C++ everything compiles fine, but the moment you add Swift into the mix you might start getting a slew of errors on your header files." />
<meta property="og:description" content="If you have an XCode project where you are trying to mix C++, Obj-C and Swift, things will not work. If you only deal with Obj-C++ everything compiles fine, but the moment you add Swift into the mix you might start getting a slew of errors on your header files." />
<link rel="canonical" href="https://ospfranco.com/post/2023/11/24/mix-c++,-obj-c-and-swift-files-in-a-single-xcode-targe/" />
<meta property="og:url" content="https://ospfranco.com/post/2023/11/24/mix-c++,-obj-c-and-swift-files-in-a-single-xcode-targe/" />
<meta property="og:site_name" content="Oscar Franco" />
<meta property="og:image" content="https://ospfranco.com/assets/profile.JPG" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-11-24T14:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://ospfranco.com/assets/profile.JPG" />
<meta property="twitter:title" content="Mix C++, Obj-C and Swift files in a single XCode targe" />
<meta name="twitter:site" content="@ospfranco" />
<meta name="twitter:creator" content="@Oscar Franco" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Oscar Franco"},"dateModified":"2023-11-24T14:00:00+01:00","datePublished":"2023-11-24T14:00:00+01:00","description":"If you have an XCode project where you are trying to mix C++, Obj-C and Swift, things will not work. If you only deal with Obj-C++ everything compiles fine, but the moment you add Swift into the mix you might start getting a slew of errors on your header files.","headline":"Mix C++, Obj-C and Swift files in a single XCode targe","image":"https://ospfranco.com/assets/profile.JPG","mainEntityOfPage":{"@type":"WebPage","@id":"https://ospfranco.com/post/2023/11/24/mix-c++,-obj-c-and-swift-files-in-a-single-xcode-targe/"},"url":"https://ospfranco.com/post/2023/11/24/mix-c++,-obj-c-and-swift-files-in-a-single-xcode-targe/"}</script>
<!-- End Jekyll SEO tag -->

  <link rel="stylesheet" href="/css/site.css" />
  <link rel="stylesheet" href="/css/inter.css" />
</head>

<html>
  <header
  class="w-full flex justify-center pt-4 pb-4 bg-white dark:bg-black fixed top-0 border-b border-gray-100 dark:border-neutral-800"
>
  <div class="w-full max-w-3xl flex items-center gap-2 px-4">
    <a href="/" class="font-semibold flex-1 text-black dark:text-white"
      >Oscar Franco</a
    >

    <!-- <div class="h-2 w-2 rounded-full bg-green-400 animate-pulse"></div>
    <a href="mailto:ospfranco@gmail.com"
    target="_blank" class="text-sm">
      Available for freelance work
    </a> -->
  </div>
</header>


<body class="flex flex-col items-center">
  <div class="px-4 pt-24 min-h-screen xl:max-w-3xl w-full">
    <div class="xl:mx-auto flex flex-col">
      <h1 class="text-black dark:text-white text-xl sm:text-3xl font-semibold">
        Mix C++, Obj-C and Swift files in a single XCode targe
      </h1>

      <p class="mt-2 dark:text-neutral-500">November 2023</p>

      <div class="pt-4 pb-20 markdown"><p>If you have an XCode project where you are trying to mix C++, Obj-C and Swift, things will not work. If you only deal with Obj-C++ everything compiles fine, but the moment you add Swift into the mix you might start getting a slew of errors on your header files.</p>

<p>The root issue is the <a href="https://stackoverflow.com/questions/47788422/cannot-use-namespace-and-cannot-include-standard-c-library-in-my-h-files">Swift compiler</a>, it doesn’t support C++, yet it still tries to compile C headers on its own. Whenever you have Swift files together with C++ files, it’s the Swift compiler that will kick-in in a first pass (followed by CLang? maybe before? doesn’t matter) and will try to compile the headers as C headers independently of what you tell it, file extensions, etc.</p>

<p>You will then start getting errors based on the C++ syntax (if you used any). For example if you are using namespaces (which don’t exist on C), you will get <a href="https://github.com/CocoaPods/CocoaPods/issues/12105#issuecomment-1824455557">invalid syntax errors</a>.</p>

<p>There are a couple workarounds. First you can wrap every single bit of C++ syntax in your headers around a macro that checks if the compiler supports C++:</p>

<pre><code class="language-C++">#if defined __cplusplus
extern "C" {
#endif

#if defiend __cplusplus

class Foo
{
    void bar(int c);
}
#endif
struct FooHandle;

void Foo_bar(struct FooHandle* foo, int c);

#if defined __cplusplus
}
#endif
</code></pre>

<p>But this is time consuming and annoying, since every header you create you will have to manually modify to check for syntax errors.</p>

<p>Another alternative is to hide the header files from the XCode file system, yet still provide them via flags that will get passed to the compilers:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"json"</span>

<span class="n">package</span> <span class="o">=</span> <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">__dir__</span><span class="p">,</span> <span class="s2">"package.json"</span><span class="p">)))</span>

<span class="no">Pod</span><span class="o">::</span><span class="no">Spec</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span>           <span class="o">=</span> <span class="s2">"matrix"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">version</span>        <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="s2">"version"</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">summary</span>        <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="s2">"description"</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">homepage</span>       <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="s2">"homepage"</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">license</span>        <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="s2">"license"</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">authors</span>        <span class="o">=</span> <span class="n">package</span><span class="p">[</span><span class="s2">"author"</span><span class="p">]</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">platforms</span>      <span class="o">=</span> <span class="p">{</span> <span class="ss">:ios</span> <span class="o">=&gt;</span> <span class="s2">"13.0"</span> <span class="p">}</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">pod_target_xcconfig</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"DEFINES_MODULE"</span> <span class="o">=&gt;</span> <span class="s2">"YES"</span><span class="p">,</span>
    <span class="s2">"SWIFT_COMPILATION_MODE"</span> <span class="o">=&gt;</span> <span class="s2">"wholemodule"</span><span class="p">,</span>
    <span class="s2">"CLANG_CXX_LANGUAGE_STANDARD"</span> <span class="o">=&gt;</span> <span class="s2">"c++17"</span><span class="p">,</span>
    <span class="c1"># ↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span>
    <span class="s2">"HEADER_SEARCH_PATHS"</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">$(PODS_TARGET_SRCROOT)/cpp/</span><span class="se">\"</span><span class="s2">/** "</span> <span class="c1"># This will link the headers at compile time, flag passed directly to the compiler</span>
  <span class="p">}</span>

  <span class="c1"># ↓↓↓↓↓↓↓↓↓↓↓↓</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">source_files</span> <span class="o">=</span> <span class="s2">"ios/**/*.{mm,swift}"</span><span class="p">,</span> <span class="s2">"cpp/**/*.{cpp,c}"</span> <span class="c1"># Do not include the headers in the sources, then XCode won't try to compile them</span>

  <span class="c1"># ↓↓↓↓↓↓↓↓↓↓↓↓↓↓</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">preserve_paths</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"cpp/**/*.h"</span><span class="p">,</span>
    <span class="s2">"ios/**/*.h"</span>
  <span class="p">]</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">dependency</span> <span class="s2">"React"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">dependency</span> <span class="s2">"React-Core"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">dependency</span> <span class="s2">"React-callinvoker"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>One side effect is that the headers will not appear on the project explorer view on XCode, which is annoying if you are developing something from scratch, you can still ⌘ + click to open it, but it won’t show navigation side bar.</p>

<h1 id="cocoapods">Cocoapods</h1>

<p>Cocoapods has a special problem with this, since it generates an umbrella header that will also get compiled by the Swift compiler and it will fail. Either of the methods described above will workaround the issue for now.</p>
</div>
    </div>

    <link
      rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <script>
      hljs.highlightAll();
    </script>
  </div>
</body>

</html>
